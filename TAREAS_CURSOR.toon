proyecto: ColLawRAG
actualizado: 2026-02-18
ejecutor: Cursor
referencia: TAREAS_CURSOR.md
url_produccion: https://col-law-rag.vercel.app
accuracy_actual: 35.9%
accuracy_objetivo_lanzamiento: >60%

estado_general:
  completadas: CU-00 CU-01 CU-02
  pendientes: CU-03 CU-04 CU-05 CU-06 CU-07 CU-08 CU-09 CU-10
  bloqueantes_lanzamiento: CU-03 CU-04 CU-05 CU-07

tareas[10]{id,prioridad,estado,titulo,archivo_principal,impacto,tiempo_estimado,depende_de}:
  CU-00,critico,completada,Fix endpoint evaluate-accuracy.mjs,scripts/evaluate-accuracy.mjs,Benchmark funcional,5min,ninguna
  CU-01,critico,completada,Fix field areaLegal→area en ingest.mjs,scripts/ingest.mjs,Metadata correcta,2h,ninguna
  CU-02,critico,completada,Reducir chunk size 3000→1000 chars,scripts/ingest.mjs,+8-12% precision,30min,CU-01
  CU-03,comercial,pendiente,Migrar SQLite→Neon Postgres,"lib/auth.ts,lib/tiers.ts",Persistencia real en Vercel,4h,ninguna
  CU-04,comercial,pendiente,Implementar NextAuth.js Google+Credentials,"app/api/auth/[...nextauth]/route.ts,lib/auth-config.ts,app/login/page.tsx",Auth real sin UUID,3h,CU-03
  CU-05,comercial,pendiente,Integrar Stripe Checkout+Webhooks,"lib/stripe.ts,app/api/stripe/checkout/route.ts,app/api/stripe/webhook/route.ts,app/pricing/page.tsx",Sistema de pagos,4h,CU-04
  CU-07,performance,pendiente,Wiring Vercel Blob en lib/retrieval.ts,lib/retrieval.ts,"cold start 50s → <3s (OpenClaw sube los archivos después)",2h,ninguna
  CU-08,conversion,pendiente,Landing page con pricing y demo embebido,"app/page.tsx,app/app/page.tsx",Conversión visitantes,5h,CU-04 CU-05
  CU-06,accuracy,pendiente,Cross-encoder reranking HuggingFace,lib/reranking.ts,+5-10% relevancia top-K,2h,ninguna
  CU-09,retencion,pendiente,Historial de consultas por usuario,"app/historial/page.tsx,app/api/historial/route.ts",Retención,2h,CU-03 CU-04

contexto_critico[5]{issue,descripcion}:
  DB_actual,"better-sqlite3 no soportado en Vercel serverless → auth y tiers SIEMPRE fallan en producción"
  paquetes_ya_instalados,"@neondatabase/serverless ^1.0.2 + @vercel/blob ^0.26.0 → solo wiring, no instalar de nuevo"
  next_auth_no_instalado,next-auth NOT INSTALLED → npm install next-auth
  stripe_no_instalado,stripe NOT INSTALLED → npm install stripe @stripe/stripe-js
  blob_script_listo,"OpenClaw ya preparó scripts/upload-indices-to-blob.mjs → solo hace falta el wiring en lib/retrieval.ts"

env_vars_pendientes[9]{tarea_id,variable,descripcion}:
  CU-03,DATABASE_URL,"postgresql://user:pass@ep-xxx.neon.tech/collawrag?sslmode=require"
  CU-04,NEXTAUTH_SECRET,openssl rand -base64 32
  CU-04,NEXTAUTH_URL,https://col-law-rag.vercel.app
  CU-04,GOOGLE_CLIENT_ID,xxx.apps.googleusercontent.com
  CU-04,GOOGLE_CLIENT_SECRET,GOCSPX-xxx
  CU-05,STRIPE_SECRET_KEY,sk_live_xxx
  CU-05,STRIPE_WEBHOOK_SECRET,whsec_xxx
  CU-05,NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY,pk_live_xxx
  CU-07,BLOB_READ_WRITE_TOKEN,"vercel_blob_rw_xxx (OpenClaw necesita esto para subir índices)"

archivos_nuevos[7]{tarea_id,ruta,descripcion}:
  CU-04,app/api/auth/[...nextauth]/route.ts,Handler NextAuth
  CU-04,lib/auth-config.ts,Providers Google+Credentials
  CU-04,app/login/page.tsx,Página de login/registro
  CU-05,app/api/stripe/checkout/route.ts,Crear sesión checkout
  CU-05,app/api/stripe/webhook/route.ts,Actualizar tier tras pago
  CU-05,app/pricing/page.tsx,Página de precios
  CU-08,app/app/page.tsx,Buscador (mover desde /)

schema_postgres[4]{tabla,campos_principales,proposito}:
  users,"id TEXT PK,tier TEXT DEFAULT free,query_count INT DEFAULT 0,last_reset TIMESTAMPTZ,created_at TIMESTAMPTZ",Usuarios y tiers freemium
  queries,"id SERIAL PK,user_id TEXT REF users,query TEXT,legal_area TEXT,response_time INT,success BOOL,created_at TIMESTAMPTZ",Log de consultas
  quality_metrics,"id SERIAL PK,query_id INT REF queries,citation_precision FLOAT,chunks_retrieved INT,response_length INT",Métricas calidad
  subscriptions,"id SERIAL PK,user_id TEXT REF users,stripe_customer_id TEXT,stripe_subscription_id TEXT,status TEXT,plan TEXT,current_period_end TIMESTAMPTZ",Pagos Stripe

planes_precios[3]{plan,precio_cop,precio_usd,limite}:
  free,0,0,10 consultas/mes
  premium,29000,7,ilimitado
  pro,149000,36,"ilimitado + API key + analytics"

orden_ejecucion[8]{semana,paso,tarea_id,sincronizar_con_openclaw}:
  1,1,CU-03,no
  1,2,CU-07,"sí: avisar a OpenClaw cuando BLOB_READ_WRITE_TOKEN esté lista"
  1,3,CU-04,no
  2,4,CU-05,no
  2,5,CU-08,no
  2,6,CU-06,no
  3,7,CU-09,no
  3,8,CU-10,no

metricas_exito[5]{metrica,valor_actual,objetivo_lanzamiento,objetivo_final}:
  accuracy_benchmark,35.9%,>60%,>85%
  cold_start_segundos,~50s,<5s (tras CU-07 + OpenClaw blob upload),<3s
  auth_funcional,false,true (CU-04),true
  pagos_funcionales,false,true (CU-05),true
  uptime_produccion,>99%,>99%,>99.9%
